namespace: app-tutorial

database:
  defines: runnable
  inherits: mongodb/mongodb

app:
  defines: runnable
  metadata:
    name: Monk Tutorial App
    icon: https://d29fhpw069ctt2.cloudfront.net/icon/image/37732/preview.svg
    description: A simple app that uses Monk to connect to a MongoDB database
    publisher: monk.io
  containers:
    app:
      image: nooga/app-tutorial:latest
      environment: 
        - <- `DB_HOST=` connection-hostname("mongo") concat-all
        - <- `DB_PORT=` connection-port("mongo") concat-all
  services:
    app:
      container: app
      port: <- $port
      host-port: <- $port
      protocol: tcp
  connections:
    mongo:
      runnable: app-tutorial/database
      service: mongodb
  variables: 
    port:
      env: PORT
      type: int
      value: 8080
      description: The port to run the app on

stack:
  defines: process-group
  runnable-list:
    - app-tutorial/database
    - app-tutorial/app